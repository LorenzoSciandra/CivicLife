{"ast":null,"code":"import _regeneratorRuntime from\"/home/michelestaffieri/Documenti/Taass/CivicLife/CivicLife/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/michelestaffieri/Documenti/Taass/CivicLife/CivicLife/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from'axios';import{Base64}from\"js-base64\";export var ValidateCode;(function(ValidateCode){ValidateCode[\"ACTIVE\"]=\"ACTIVE\";ValidateCode[\"EXPIRED\"]=\"EXPIRED\";ValidateCode[\"INVALID_EMAIL\"]=\"INVALID_EMAIL\";ValidateCode[\"INVALID_TOKEN\"]=\"INVALID_TOKEN\";ValidateCode[\"INVALID_PROVIDER\"]=\"INVALID_PROVIDER\";ValidateCode[\"INCOMPLETE_CREDENTIALS\"]=\"INCOMPLETE_CREDENTIALS\";ValidateCode[\"AUTH_SERVER_ERROR\"]=\"AUTH_SERVER_ERROR\";ValidateCode[\"UPDATE_FAIL\"]=\"UPDATE_FAIL\";ValidateCode[\"LOGOUT_FAIL\"]=\"LOGOUT_FAIL\";ValidateCode[\"LOGIN_FAIL\"]=\"LOGIN_FAIL\";ValidateCode[\"GET_FAIL\"]=\"GET_FAIL\";ValidateCode[\"DELETE_FAIL\"]=\"DELETE_FAIL\";})(ValidateCode||(ValidateCode={}));export function isInstanceOfAuthError(object){return'code'in object;}export var exchangeToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(token){var url;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:url='http://172.19.0.10:8080/authAPI/v1/token/'+token;_context.next=3;return axios.get(url).then(function(response){var data=Base64.decode(response.data);var values=data.split(\",\");for(var i=0;i<values.length;i++){values[i]=values[i].split(\": \")[1];}return{email:values[0],provider:values[1],token:values[2]};}).catch(function(){console.log(\"errore nella catch\");var authError={code:ValidateCode.LOGIN_FAIL,method:'GET',requestedPath:url};return authError;});case 3:return _context.abrupt(\"return\",_context.sent);case 4:case\"end\":return _context.stop();}},_callee);}));return function exchangeToken(_x){return _ref.apply(this,arguments);};}();export var logoutUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(tokenData){var TokenKey,url;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:TokenKey={email:tokenData.email,provider:tokenData.provider};url='http://172.19.0.10:8080/authAPI/v1/deleteToken/'+tokenData.email;_context2.next=4;return axios.post(url,JSON.stringify(TokenKey),{headers:{\"Content-Type\":\"text/plain\"}}).then(function(value){return value.data;}).catch(function(){var authError={code:ValidateCode.LOGOUT_FAIL,method:'POST',requestedPath:url.split('?')[0]};return authError;});case 4:return _context2.abrupt(\"return\",_context2.sent);case 5:case\"end\":return _context2.stop();}},_callee2);}));return function logoutUser(_x2){return _ref2.apply(this,arguments);};}();","map":{"version":3,"names":["axios","Base64","ValidateCode","isInstanceOfAuthError","object","exchangeToken","token","url","get","then","response","data","decode","values","split","i","length","email","provider","catch","console","log","authError","code","LOGIN_FAIL","method","requestedPath","logoutUser","tokenData","TokenKey","post","JSON","stringify","headers","value","LOGOUT_FAIL"],"sources":["/home/michelestaffieri/Documenti/Taass/CivicLife/CivicLife/frontend/src/APIs/OauthAPI.ts"],"sourcesContent":["import axios from 'axios';\nimport {Base64} from \"js-base64\";\n\nexport type TokenData= {\n    email:string,\n    provider:string,\n    token:string,\n}\n\nexport enum ValidateCode{\n    ACTIVE = 'ACTIVE',\n    EXPIRED = 'EXPIRED',\n    INVALID_EMAIL = 'INVALID_EMAIL',\n    INVALID_TOKEN = 'INVALID_TOKEN',\n    INVALID_PROVIDER = 'INVALID_PROVIDER',\n    INCOMPLETE_CREDENTIALS = 'INCOMPLETE_CREDENTIALS',\n    AUTH_SERVER_ERROR = 'AUTH_SERVER_ERROR',\n    UPDATE_FAIL = 'UPDATE_FAIL',\n    LOGOUT_FAIL = 'LOGOUT_FAIL',\n    LOGIN_FAIL = 'LOGIN_FAIL',\n    GET_FAIL = 'GET_FAIL',\n    DELETE_FAIL = 'DELETE_FAIL',\n\n}\n\nexport interface AuthError{\n    code: ValidateCode,\n    method: string,\n    requestedPath: string\n}\n\nexport function isInstanceOfAuthError(object:any): object is AuthError {\n    return 'code' in object\n}\n\nexport const exchangeToken = async (token: string):Promise<TokenData|AuthError>=> {\n\n    let url = 'http://172.19.0.10:8080/authAPI/v1/token/'+ token\n    return await axios.get(url).then((response) => {\n        const data = Base64.decode(response.data);\n        const values = data.split(\",\")\n        for(let i = 0; i < values.length; i++){\n            values[i] = values[i].split(\": \")[1]\n        }\n        return{\n            email: values[0],\n            provider: values[1],\n            token: values[2],\n        }\n    }).catch(() => {\n        console.log(\"errore nella catch\")\n        const authError: AuthError = {\n            code: ValidateCode.LOGIN_FAIL,\n            method: 'GET',\n            requestedPath: url\n        }\n        return authError\n    })\n}\n\nexport const logoutUser = async (tokenData: TokenData): Promise<boolean | AuthError> => {\n\n    const TokenKey= {\n        email: tokenData.email,\n        provider: tokenData.provider,\n    }\n\n    const url = 'http://172.19.0.10:8080/authAPI/v1/deleteToken/' + tokenData.email\n    return await axios.post<boolean| AuthError>(url,\n        JSON.stringify(TokenKey),\n        {\n            headers: {\"Content-Type\": \"text/plain\"}\n        })\n        .then(value => {\n            return value.data;\n        }).catch(() => {\n            const authError: AuthError = {\n                code: ValidateCode.LOGOUT_FAIL,\n                method: 'POST',\n                requestedPath: url.split('?')[0]\n            }\n            return authError\n        })\n}\n\n"],"mappings":"kUAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,OAAQC,MAAM,KAAO,WAAW,CAQhC,UAAYC,aAAY,CAcvB,UAdWA,YAAY,EAAZA,YAAY,oBAAZA,YAAY,sBAAZA,YAAY,kCAAZA,YAAY,kCAAZA,YAAY,wCAAZA,YAAY,oDAAZA,YAAY,0CAAZA,YAAY,8BAAZA,YAAY,8BAAZA,YAAY,4BAAZA,YAAY,wBAAZA,YAAY,iCAAZA,YAAY,GAAZA,YAAY,MAsBxB,MAAO,SAASC,sBAAqB,CAACC,MAAU,CAAuB,CACnE,MAAO,MAAM,EAAIA,OAAM,CAC3B,CAEA,MAAO,IAAMC,cAAa,4FAAG,iBAAOC,KAAa,2HAEzCC,GAAG,CAAG,2CAA2C,CAAED,KAAK,uBAC/CN,MAAK,CAACQ,GAAG,CAACD,GAAG,CAAC,CAACE,IAAI,CAAC,SAACC,QAAQ,CAAK,CAC3C,GAAMC,KAAI,CAAGV,MAAM,CAACW,MAAM,CAACF,QAAQ,CAACC,IAAI,CAAC,CACzC,GAAME,OAAM,CAAGF,IAAI,CAACG,KAAK,CAAC,GAAG,CAAC,CAC9B,IAAI,GAAIC,EAAC,CAAG,CAAC,CAAEA,CAAC,CAAGF,MAAM,CAACG,MAAM,CAAED,CAAC,EAAE,CAAC,CAClCF,MAAM,CAACE,CAAC,CAAC,CAAGF,MAAM,CAACE,CAAC,CAAC,CAACD,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CACxC,CACA,MAAM,CACFG,KAAK,CAAEJ,MAAM,CAAC,CAAC,CAAC,CAChBK,QAAQ,CAAEL,MAAM,CAAC,CAAC,CAAC,CACnBP,KAAK,CAAEO,MAAM,CAAC,CAAC,CACnB,CAAC,CACL,CAAC,CAAC,CAACM,KAAK,CAAC,UAAM,CACXC,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAC,CACjC,GAAMC,UAAoB,CAAG,CACzBC,IAAI,CAAErB,YAAY,CAACsB,UAAU,CAC7BC,MAAM,CAAE,KAAK,CACbC,aAAa,CAAEnB,GACnB,CAAC,CACD,MAAOe,UAAS,CACpB,CAAC,CAAC,4GACL,kBAvBYjB,cAAa,4CAuBzB,CAED,MAAO,IAAMsB,WAAU,6FAAG,kBAAOC,SAAoB,wIAE3CC,QAAQ,CAAE,CACZZ,KAAK,CAAEW,SAAS,CAACX,KAAK,CACtBC,QAAQ,CAAEU,SAAS,CAACV,QACxB,CAAC,CAEKX,GAAG,CAAG,iDAAiD,CAAGqB,SAAS,CAACX,KAAK,wBAClEjB,MAAK,CAAC8B,IAAI,CAAqBvB,GAAG,CAC3CwB,IAAI,CAACC,SAAS,CAACH,QAAQ,CAAC,CACxB,CACII,OAAO,CAAE,CAAC,cAAc,CAAE,YAAY,CAC1C,CAAC,CAAC,CACDxB,IAAI,CAAC,SAAAyB,KAAK,CAAI,CACX,MAAOA,MAAK,CAACvB,IAAI,CACrB,CAAC,CAAC,CAACQ,KAAK,CAAC,UAAM,CACX,GAAMG,UAAoB,CAAG,CACzBC,IAAI,CAAErB,YAAY,CAACiC,WAAW,CAC9BV,MAAM,CAAE,MAAM,CACdC,aAAa,CAAEnB,GAAG,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CACnC,CAAC,CACD,MAAOQ,UAAS,CACpB,CAAC,CAAC,gHACT,kBAvBYK,WAAU,8CAuBtB"},"metadata":{},"sourceType":"module","externalDependencies":[]}